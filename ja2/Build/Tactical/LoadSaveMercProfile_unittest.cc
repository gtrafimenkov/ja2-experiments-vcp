// -*-coding: utf-8-with-signature-unix;-*-

#include "Tactical/LoadSaveMercProfile.h"

#include "Laptop/IMPCompileCharacter.h"
#include "SGP/EncodingCorrectors.h"
#include "SGP/FileMan.h"
#include "Tactical/SoldierProfile.h"
#include "Tactical/SoldierProfileType.h"
#include "gtest/gtest.h"

TEST(LoadSaveMercProfileTest, vanillaProfile) {
  MERCPROFILESTRUCT p;
  int32_t profileId;
  int32_t portraitNumber;
  ExtractImpProfileFromFile("unittests/saves/vanilla-russian/IMP.dat", &profileId, &portraitNumber,
                            p);
  EXPECT_EQ(profileId, PLAYER_GENERATED_CHARACTER_ID);
  EXPECT_EQ(portraitNumber, 0);
  EXPECT_STREQ(p.zName, L"Foo Bar .....................");
  EXPECT_STREQ(p.zNickname, L".FooBar.");
  // uint8_t		ubFaceIndex;
  // PaletteRepID		PANTS;
  // PaletteRepID		VEST;
  // PaletteRepID		SKIN;
  // PaletteRepID		HAIR;
  EXPECT_EQ(p.bSex, MALE);
  // int8_t		bArmourAttractiveness;
  // uint8_t		ubMiscFlags2;
  // int8_t		bEvolution;
  // uint8_t		ubMiscFlags;
  // uint8_t		bSexist;
  // int8_t		bLearnToHate;
  // uint8_t		ubQuoteRecord;
  // int8_t		bDeathRate;
  // int16_t		sExpLevelGain;
  // int16_t		sLifeGain;
  // int16_t		sAgilityGain;
  // int16_t		sDexterityGain;
  // int16_t		sWisdomGain;
  // int16_t		sMarksmanshipGain;
  // int16_t		sMedicalGain;
  // int16_t		sMechanicGain;
  // int16_t		sExplosivesGain;
  // uint8_t		ubBodyType;
  // int8_t		bMedical;
  // uint16_t	usEyesX;
  // uint16_t	usEyesY;
  // uint16_t	usMouthX;
  // uint16_t	usMouthY;
  // uint32_t	uiBlinkFrequency;
  // uint32_t	uiExpressionFrequency;
  EXPECT_EQ(p.sSectorX, 0);
  EXPECT_EQ(p.sSectorY, 0);
  // uint32_t	uiDayBecomesAvailable;
  EXPECT_EQ(p.bStrength, 55);
  EXPECT_EQ(p.bLifeMax, 55);
  // int8_t		bExpLevelDelta;
  // int8_t		bLifeDelta;
  // int8_t		bAgilityDelta;
  // int8_t		bDexterityDelta;
  // int8_t		bWisdomDelta;
  // int8_t		bMarksmanshipDelta;
  // int8_t		bMedicalDelta;
  // int8_t		bMechanicDelta;
  // int8_t		bExplosivesDelta;
  // int8_t    bStrengthDelta;
  // int8_t    bLeadershipDelta;
  // uint16_t  usKills;
  // uint16_t  usAssists;
  // uint16_t  usShotsFired;
  // uint16_t  usShotsHit;
  // uint16_t  usBattlesFought;
  // uint16_t  usTimesWounded;
  // uint16_t  usTotalDaysServed;
  // int16_t		sLeadershipGain;
  // int16_t		sStrengthGain;
  // uint32_t	uiBodyTypeSubFlags;
  // int16_t	sSalary;
  EXPECT_EQ(p.bLife, 55);
  EXPECT_EQ(p.bDexterity, 55);
  // int8_t	bPersonalityTrait;
  // int8_t	bSkillTrait;
  // int8_t	bReputationTolerance;
  EXPECT_EQ(p.bExplosive, 55);
  // int8_t	bSkillTrait2;
  EXPECT_EQ(p.bLeadership, 55);
  // int8_t	bBuddy[5];
  // int8_t	bHated[5];
  // int8_t	bExpLevel;
  EXPECT_EQ(p.bMarksmanship, 85);
  EXPECT_EQ(p.bWisdom, 65);
  // uint8_t	bInvStatus[19];
  // uint8_t bInvNumber[19];
  // uint16_t usApproachFactor[4];
  // int8_t	bMainGunAttractiveness;
  EXPECT_EQ(p.bAgility, 55);
  // BOOLEAN	fUseProfileInsertionInfo;
  // int16_t		sGridNo;
  // uint8_t		ubQuoteActionID;
  // int8_t		bMechanical;
  // uint8_t	ubInvUndroppable;
  // uint8_t	ubRoomRangeStart[2];
  // uint16_t inv[19];
  // uint16_t usStatChangeChances[ 12 ];
  // uint16_t usStatChangeSuccesses[ 12 ];
  // uint8_t	ubStrategicInsertionCode;
  // uint8_t	ubRoomRangeEnd[2];
  // uint8_t ubLastQuoteSaid;
  // int8_t bRace;
  // int8_t bNationality;
  // int8_t bAppearance;
  // int8_t bAppearanceCareLevel;
  // int8_t bRefinement;
  // int8_t bRefinementCareLevel;
  // int8_t bHatedNationality;
  // int8_t bHatedNationalityCareLevel;
  // int8_t bRacist;
  // uint32_t uiWeeklySalary;
  // uint32_t uiBiWeeklySalary;
  // int8_t bMedicalDeposit;
  // int8_t bAttitude;
  // uint16_t sMedicalDepositAmount;
  // int8_t bLearnToLike;
  // uint8_t ubApproachVal[4];
  // uint8_t ubApproachMod[3][4];
  // int8_t bTown;
  // int8_t bTownAttachment;
  // uint16_t usOptionalGearCost;
  // int8_t bMercOpinion[75];
  // int8_t bApproached;
  // int8_t bMercStatus;
  // int8_t bHatedTime[5];
  // int8_t bLearnToLikeTime;
  // int8_t bLearnToHateTime;
  // int8_t bHatedCount[5];
  // int8_t bLearnToLikeCount;
  // int8_t bLearnToHateCount;
  // uint8_t ubLastDateSpokenTo;
  // uint8_t bLastQuoteSaidWasSpecial;
  // int8_t	bSectorZ;
  // uint16_t usStrategicInsertionData;
  // int8_t bFriendlyOrDirectDefaultResponseUsedRecently;
  // int8_t bRecruitDefaultResponseUsedRecently;
  // int8_t bThreatenDefaultResponseUsedRecently;
  // int8_t bNPCData;
  // int32_t	iBalance;
  // uint8_t	ubCivilianGroup;
  // uint8_t	ubNeedForSleep;
  // uint32_t	uiMoney;
  // int8_t	bNPCData2;
  // uint8_t	ubMiscFlags3;
  // uint8_t ubDaysOfMoraleHangover;
  // uint8_t	ubNumTimesDrugUseInLifetime;
  // uint32_t	uiPrecedentQuoteSaid;
  // int16_t		sPreCombatGridNo;
  // uint8_t		ubTimeTillNextHatedComplaint;
  // uint8_t		ubSuspiciousDeath;
  // int32_t	iMercMercContractLength;
  // uint32_t	uiTotalCostToDate;
}

TEST(LoadSaveMercProfileTest, stracLinuxProfile) {
  MERCPROFILESTRUCT p;
  int32_t profileId;
  int32_t portraitNumber;
  ExtractImpProfileFromFile("unittests/saves/strac-macos/imp.dat", &profileId, &portraitNumber, p);
  EXPECT_EQ(profileId, PLAYER_GENERATED_CHARACTER_ID);
  EXPECT_EQ(portraitNumber, 0);
  EXPECT_STREQ(p.zName, L"Vasya Вася Курочкин Kurochki");
  EXPECT_STREQ(p.zNickname, L"ВАСЯКУРА");
  // uint8_t		ubFaceIndex;
  // PaletteRepID		PANTS;
  // PaletteRepID		VEST;
  // PaletteRepID		SKIN;
  // PaletteRepID		HAIR;
  EXPECT_EQ(p.bSex, MALE);
  // int8_t		bArmourAttractiveness;
  // uint8_t		ubMiscFlags2;
  // int8_t		bEvolution;
  // uint8_t		ubMiscFlags;
  // uint8_t		bSexist;
  // int8_t		bLearnToHate;
  // uint8_t		ubQuoteRecord;
  // int8_t		bDeathRate;
  // int16_t		sExpLevelGain;
  // int16_t		sLifeGain;
  // int16_t		sAgilityGain;
  // int16_t		sDexterityGain;
  // int16_t		sWisdomGain;
  // int16_t		sMarksmanshipGain;
  // int16_t		sMedicalGain;
  // int16_t		sMechanicGain;
  // int16_t		sExplosivesGain;
  // uint8_t		ubBodyType;
  // int8_t		bMedical;
  // uint16_t	usEyesX;
  // uint16_t	usEyesY;
  // uint16_t	usMouthX;
  // uint16_t	usMouthY;
  // uint32_t	uiBlinkFrequency;
  // uint32_t	uiExpressionFrequency;
  EXPECT_EQ(p.sSectorX, 0);
  EXPECT_EQ(p.sSectorY, 0);
  // uint32_t	uiDayBecomesAvailable;
  EXPECT_EQ(p.bStrength, 55);
  EXPECT_EQ(p.bLifeMax, 55);
  // int8_t		bExpLevelDelta;
  // int8_t		bLifeDelta;
  // int8_t		bAgilityDelta;
  // int8_t		bDexterityDelta;
  // int8_t		bWisdomDelta;
  // int8_t		bMarksmanshipDelta;
  // int8_t		bMedicalDelta;
  // int8_t		bMechanicDelta;
  // int8_t		bExplosivesDelta;
  // int8_t    bStrengthDelta;
  // int8_t    bLeadershipDelta;
  // uint16_t  usKills;
  // uint16_t  usAssists;
  // uint16_t  usShotsFired;
  // uint16_t  usShotsHit;
  // uint16_t  usBattlesFought;
  // uint16_t  usTimesWounded;
  // uint16_t  usTotalDaysServed;
  // int16_t		sLeadershipGain;
  // int16_t		sStrengthGain;
  // uint32_t	uiBodyTypeSubFlags;
  // int16_t	sSalary;
  EXPECT_EQ(p.bLife, 55);
  EXPECT_EQ(p.bDexterity, 55);
  // int8_t	bPersonalityTrait;
  // int8_t	bSkillTrait;
  // int8_t	bReputationTolerance;
  EXPECT_EQ(p.bExplosive, 55);
  // int8_t	bSkillTrait2;
  EXPECT_EQ(p.bLeadership, 55);
  // int8_t	bBuddy[5];
  // int8_t	bHated[5];
  // int8_t	bExpLevel;
  EXPECT_EQ(p.bMarksmanship, 85);
  EXPECT_EQ(p.bWisdom, 65);
  // uint8_t	bInvStatus[19];
  // uint8_t bInvNumber[19];
  // uint16_t usApproachFactor[4];
  // int8_t	bMainGunAttractiveness;
  EXPECT_EQ(p.bAgility, 55);
  // BOOLEAN	fUseProfileInsertionInfo;
  // int16_t		sGridNo;
  // uint8_t		ubQuoteActionID;
  // int8_t		bMechanical;
  // uint8_t	ubInvUndroppable;
  // uint8_t	ubRoomRangeStart[2];
  // uint16_t inv[19];
  // uint16_t usStatChangeChances[ 12 ];
  // uint16_t usStatChangeSuccesses[ 12 ];
  // uint8_t	ubStrategicInsertionCode;
  // uint8_t	ubRoomRangeEnd[2];
  // uint8_t ubLastQuoteSaid;
  // int8_t bRace;
  // int8_t bNationality;
  // int8_t bAppearance;
  // int8_t bAppearanceCareLevel;
  // int8_t bRefinement;
  // int8_t bRefinementCareLevel;
  // int8_t bHatedNationality;
  // int8_t bHatedNationalityCareLevel;
  // int8_t bRacist;
  // uint32_t uiWeeklySalary;
  // uint32_t uiBiWeeklySalary;
  // int8_t bMedicalDeposit;
  // int8_t bAttitude;
  // uint16_t sMedicalDepositAmount;
  // int8_t bLearnToLike;
  // uint8_t ubApproachVal[4];
  // uint8_t ubApproachMod[3][4];
  // int8_t bTown;
  // int8_t bTownAttachment;
  // uint16_t usOptionalGearCost;
  // int8_t bMercOpinion[75];
  // int8_t bApproached;
  // int8_t bMercStatus;
  // int8_t bHatedTime[5];
  // int8_t bLearnToLikeTime;
  // int8_t bLearnToHateTime;
  // int8_t bHatedCount[5];
  // int8_t bLearnToLikeCount;
  // int8_t bLearnToHateCount;
  // uint8_t ubLastDateSpokenTo;
  // uint8_t bLastQuoteSaidWasSpecial;
  // int8_t	bSectorZ;
  // uint16_t usStrategicInsertionData;
  // int8_t bFriendlyOrDirectDefaultResponseUsedRecently;
  // int8_t bRecruitDefaultResponseUsedRecently;
  // int8_t bThreatenDefaultResponseUsedRecently;
  // int8_t bNPCData;
  // int32_t	iBalance;
  // uint8_t	ubCivilianGroup;
  // uint8_t	ubNeedForSleep;
  // uint32_t	uiMoney;
  // int8_t	bNPCData2;
  // uint8_t	ubMiscFlags3;
  // uint8_t ubDaysOfMoraleHangover;
  // uint8_t	ubNumTimesDrugUseInLifetime;
  // uint32_t	uiPrecedentQuoteSaid;
  // int16_t		sPreCombatGridNo;
  // uint8_t		ubTimeTillNextHatedComplaint;
  // uint8_t		ubSuspiciousDeath;
  // int32_t	iMercMercContractLength;
  // uint32_t	uiTotalCostToDate;
}
